# 师生联动系统设计文档

## 📋 系统概述

本系统实现了教师和学生之间的完整互动机制，通过班级管理、资源推送、教师反馈等功能，建立了师生之间的联动关系。

---

## 🗄️ 数据库设计

### 1. 班级表 (t_class)

```sql
CREATE TABLE IF NOT EXISTS t_class (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,              -- 班级名称
  grade_level VARCHAR(20),                 -- 年级
  teacher_id BIGINT NOT NULL,              -- 教师ID
  invite_code VARCHAR(20) UNIQUE NOT NULL, -- 邀请码（6位大写字母+数字）
  description TEXT,                        -- 班级描述
  status VARCHAR(20) DEFAULT 'ACTIVE',     -- 状态
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 2. 班级成员表 (t_class_member)

```sql
CREATE TABLE IF NOT EXISTS t_class_member (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  class_id BIGINT NOT NULL,                -- 班级ID
  student_id BIGINT NOT NULL,              -- 学生ID
  joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  status VARCHAR(20) DEFAULT 'ACTIVE',
  UNIQUE KEY uk_class_student (class_id, student_id)
);
```

### 3. 教师推送表 (t_teacher_push)

```sql
CREATE TABLE IF NOT EXISTS t_teacher_push (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  teacher_id BIGINT NOT NULL,              -- 教师ID
  class_id BIGINT NOT NULL,                -- 目标班级ID
  title VARCHAR(100) NOT NULL,             -- 推送标题
  content TEXT,                            -- 推送内容
  resource_type VARCHAR(20) NOT NULL,      -- 资源类型：KNOWLEDGE/QUESTION/NOTICE
  resource_id BIGINT,                      -- 关联的资源ID
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4. 教师反馈表 (t_teacher_feedback)

```sql
CREATE TABLE IF NOT EXISTS t_teacher_feedback (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  teacher_id BIGINT NOT NULL,              -- 教师ID
  student_id BIGINT NOT NULL,              -- 学生ID
  error_book_id BIGINT NOT NULL,           -- 错题ID
  feedback TEXT NOT NULL,                  -- 反馈内容
  rating INT,                              -- 评分1-5
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

---

## 🔌 后端API接口

### 教师端API

#### 1. 创建班级
```
POST /api/classroom/create
Authorization: Bearer {token}

Request Body:
{
  "name": "高一1班",
  "gradeLevel": "高一",
  "description": "数学班"
}

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "name": "高一1班",
    "gradeLevel": "高一",
    "teacherId": 2,
    "inviteCode": "ABC123",  // 自动生成的邀请码
    "description": "数学班",
    "status": "ACTIVE",
    "createdAt": "2024-01-01T10:00:00"
  }
}
```

#### 2. 获取教师的班级列表
```
GET /api/classroom/teacher/classes
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "高一1班",
      "gradeLevel": "高一",
      "inviteCode": "ABC123",
      "description": "数学班",
      "studentCount": 35,
      "createdAt": "2024-01-01T10:00:00"
    }
  ]
}
```

#### 3. 获取班级学生列表
```
GET /api/classroom/class/{classId}/students
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [
    {
      "id": 3,
      "username": "student1",
      "realName": "张三",
      "joinedAt": "2024-01-02T10:00:00",
      "errorCount": 15  // 该学生的错题数
    }
  ]
}
```

#### 4. 推送资源给班级
```
POST /api/classroom/push
Authorization: Bearer {token}

Request Body:
{
  "classId": 1,
  "title": "本周作业",
  "content": "请完成以下练习题",
  "resourceType": "QUESTION",  // KNOWLEDGE/QUESTION/NOTICE
  "resourceId": 100            // 可选，关联的题目/知识点ID
}

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "teacherId": 2,
    "classId": 1,
    "title": "本周作业",
    "content": "请完成以下练习题",
    "resourceType": "QUESTION",
    "resourceId": 100,
    "createdAt": "2024-01-05T10:00:00"
  }
}
```

#### 5. 给学生错题添加反馈
```
POST /api/classroom/feedback
Authorization: Bearer {token}

Request Body:
{
  "studentId": 3,
  "errorBookId": 50,
  "feedback": "这道题的关键是理解公式的应用...",
  "rating": 4
}

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "teacherId": 2,
    "studentId": 3,
    "errorBookId": 50,
    "feedback": "这道题的关键是理解公式的应用...",
    "rating": 4,
    "createdAt": "2024-01-06T10:00:00"
  }
}
```

---

### 学生端API

#### 1. 加入班级
```
POST /api/classroom/join
Authorization: Bearer {token}

Request Body:
{
  "inviteCode": "ABC123"
}

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "classId": 1,
    "studentId": 3,
    "joinedAt": "2024-01-02T10:00:00",
    "status": "ACTIVE"
  }
}
```

#### 2. 获取学生的班级列表
```
GET /api/classroom/student/classes
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "高一1班",
      "gradeLevel": "高一",
      "joinedAt": "2024-01-02T10:00:00",
      "teacherName": "李老师"
    }
  ]
}
```

#### 3. 获取教师推送列表
```
GET /api/classroom/student/pushes
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "本周作业",
      "content": "请完成以下练习题",
      "resourceType": "QUESTION",
      "resourceId": 100,
      "createdAt": "2024-01-05T10:00:00",
      "teacherName": "李老师",
      "className": "高一1班"
    }
  ]
}
```

#### 4. 查看错题的教师反馈
```
GET /api/classroom/feedback/errorbook/{errorBookId}

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "feedback": "这道题的关键是理解公式的应用...",
      "rating": 4,
      "createdAt": "2024-01-06T10:00:00",
      "teacherName": "李老师"
    }
  ]
}
```

---

## 🎯 核心功能流程

### 1. 班级创建与加入流程

```
教师端:
1. 教师登录系统
2. 创建班级（输入班级名、年级、描述）
3. 系统自动生成6位邀请码（如：ABC123）
4. 教师将邀请码分享给学生

学生端:
1. 学生登录系统
2. 输入邀请码加入班级
3. 成功加入后，可以接收教师推送
```

### 2. 教师推送资源流程

```
教师端:
1. 选择班级
2. 创建推送（选择类型：通知/题目/知识点）
3. 填写标题和内容
4. 可选：关联具体的题目或知识点
5. 发送推送

学生端:
1. 在"推送列表"中查看所有推送
2. 按时间倒序显示
3. 显示推送来源（哪个老师、哪个班级）
4. 点击可查看详细内容
```

### 3. 教师反馈流程

```
教师端:
1. 查看班级学生列表
2. 查看学生的错题
3. 针对某道错题添加反馈批注
4. 可选：给出1-5星评分

学生端:
1. 在错题本中查看自己的错题
2. 如果有教师反馈，显示反馈标记
3. 点击查看教师的详细反馈
4. 根据反馈进行订正和改进
```

---

## 💡 使用场景示例

### 场景1：教师布置作业

1. 教师在题库中选择10道题
2. 创建推送：类型选择"QUESTION"
3. 标题："本周数学作业"
4. 内容："请完成第3章练习题1-10"
5. 班级内所有学生都会收到推送通知

### 场景2：教师针对性指导

1. 教师查看"高一1班"学生列表
2. 发现张三的错题较多（15道）
3. 点击查看张三的错题详情
4. 针对某道错题添加反馈："这类题要注意..."
5. 张三在错题本中看到教师反馈

### 场景3：知识点推送

1. 教师发现班级对"二次函数"掌握不好
2. 创建推送：类型选择"KNOWLEDGE"
3. 关联"二次函数"知识点
4. 推送相关视频、笔记资源
5. 学生可以重点学习该知识点

---

## 🔐 权限控制

### 教师权限
- ✅ 创建班级
- ✅ 查看自己创建的班级
- ✅ 查看班级学生列表和学习数据
- ✅ 向班级推送资源
- ✅ 给学生错题添加反馈
- ❌ 不能查看其他教师的班级

### 学生权限
- ✅ 通过邀请码加入班级
- ✅ 查看自己加入的班级
- ✅ 接收教师推送
- ✅ 查看自己错题的教师反馈
- ❌ 不能查看其他学生的数据
- ❌ 不能创建班级

---

## 📊 数据统计

### 教师端可查看：
- 班级总人数
- 每个学生的错题数
- 班级整体错题分布
- 知识点掌握情况

### 学生端可查看：
- 加入的班级列表
- 收到的推送列表
- 教师反馈列表

---

## 🚀 后续扩展

### 可扩展功能：
1. **班级公告板** - 教师发布公告，学生查看
2. **作业提交** - 学生提交作业，教师批阅
3. **成绩分析** - 自动分析班级成绩趋势
4. **家长端** - 家长查看孩子学习情况
5. **分组管理** - 班级内创建学习小组
6. **在线答疑** - 学生提问，教师解答
7. **学习计划** - 教师为学生制定学习计划
8. **数据报表** - 生成各类统计报表

---

## ⚠️ 注意事项

1. **邀请码安全性**：邀请码应该定期更新，避免泄露
2. **数据隐私**：教师只能看到自己班级的学生数据
3. **推送频率**：避免过度推送，影响学生学习
4. **反馈质量**：教师反馈应该具体、有针对性
5. **性能优化**：大班级（50+学生）需要考虑查询优化

---

## 🔄 系统流程图

```
教师创建班级
    ↓
生成邀请码
    ↓
学生输入邀请码 → 加入班级成功
    ↓
建立师生关联
    ↓
┌─────────────┬─────────────┐
│  教师推送    │  教师反馈    │
│  资源/题目   │  错题批注    │
└─────────────┴─────────────┘
    ↓              ↓
┌─────────────┬─────────────┐
│ 学生接收推送 │ 学生查看反馈 │
└─────────────┴─────────────┘
```

---

## 📝 快速开始

### 教师端：
1. 注册教师账号
2. 登录系统
3. 创建班级
4. 分享邀请码给学生
5. 开始推送资源和反馈

### 学生端：
1. 注册学生账号
2. 登录系统
3. 输入教师提供的邀请码
4. 加入班级成功
5. 接收教师推送和反馈

---

**系统已完成后端开发，接下来需要实现前端界面！** 🎉

