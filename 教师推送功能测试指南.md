# 📚 教师推送功能测试指南

## 🎯 功能说明

**教师推送**功能允许教师发布学习任务，学生可以在"教师推送"页面查看并完成。

---

## 🔍 问题诊断流程

### 步骤1: 运行测试脚本

```bash
双击运行: test-task-push.bat
```

这个脚本会：
- ✅ 检查数据库中的用户和任务数据
- ✅ 自动修复学生班级信息
- ✅ 创建一个测试任务
- ✅ 为学生分配任务

---

### 步骤2: 查看数据库（可选）

打开MySQL或Navicat，执行：

```sql
USE zszg;

-- 查看学生的班级信息
SELECT id, username, real_name, role, class_id 
FROM t_user 
WHERE role = 'ROLE_STUDENT';

-- 查看任务列表
SELECT id, title, class_id, class_name, status 
FROM t_task;

-- 查看学生任务分配
SELECT st.id, st.student_name, t.title, st.is_completed
FROM t_student_task st
JOIN t_task t ON st.task_id = t.id;
```

---

### 步骤3: 测试学生端

1. **刷新浏览器**
   ```
   按 Ctrl + Shift + R (强制刷新)
   ```

2. **打开浏览器Console**（F12 → Console标签）

3. **点击"教师推送"菜单**

4. **查看Console输出**

**预期看到：**
```javascript
📌 当前登录用户: {id: 1, username: "student1", ...}
🔍 正在获取学生任务列表... 学生ID: 1
📡 后端返回数据: {success: true, data: [...]}
✅ 获取到 1 个任务
📋 任务列表已更新: [{...}]
```

**如果看到：**
```javascript
ℹ️ 后端返回空数据，显示示例任务
```
说明后端返回了空数组，请继续下面的诊断。

---

## 🔧 常见问题解决

### 问题1: 学生班级信息为空

**症状**：数据库中学生的`class_id`为`NULL`或空字符串

**解决方案**：
```sql
UPDATE t_user 
SET class_id = '1', grade = '高一'
WHERE role = 'ROLE_STUDENT' 
  AND (class_id IS NULL OR class_id = '');
```

---

### 问题2: 教师发布任务时班级ID不匹配

**症状**：教师发布任务到"班级2"，但学生在"班级1"

**解决方案**：
1. 确保教师选择的班级ID和学生的class_id一致
2. 或者修改学生的class_id：
```sql
UPDATE t_user SET class_id = '2' WHERE username = 'student1';
```

---

### 问题3: 任务状态未更新为"已下发"

**症状**：t_task表中status还是"待下发"

**解决方案**：手动发布任务
```sql
-- 方法1: 通过教师端UI点击"发布"按钮

-- 方法2: 直接修改数据库（测试用）
UPDATE t_task SET status = '已下发' WHERE id = 任务ID;

-- 然后手动创建学生任务记录
INSERT INTO t_student_task (task_id, student_id, student_name, is_completed)
SELECT 任务ID, id, real_name, FALSE
FROM t_user
WHERE role = 'ROLE_STUDENT' AND class_id = '1';
```

---

### 问题4: 后端API返回401/403

**症状**：Console显示"登录已过期"

**解决方案**：
1. 退出登录
2. 重新登录
3. 刷新页面

---

## ✅ 完整测试流程

### 教师端测试

1. **登录教师账号**

2. **进入"教师推送"页面**

3. **选择班级**：选择"高一1班"（或你创建的班级）

4. **输入任务描述**：
   ```
   同学们，本周五前完成第三章函数与导数的错题整理，每人至少录入5道错题。
   ```

5. **点击"AI智能解析"**（可选）

6. **点击"发布任务"**

7. **等待提示"任务发布成功"**

---

### 学生端测试

1. **登录学生账号**

2. **确保学生账号的class_id与教师发布的一致**

3. **进入"教师推送"页面**

4. **查看任务列表**

**预期结果**：
- ✅ 待完成任务数量显示"1"
- ✅ 任务卡片显示正确的标题和内容
- ✅ 显示教师姓名和班级名称
- ✅ 显示截止时间

---

## 📊 数据库表结构说明

### t_task (任务表)
- `id` - 任务ID
- `teacher_id` - 发布教师ID
- `class_id` - 目标班级ID（⚠️ 关键字段）
- `class_name` - 班级名称
- `title` - 任务标题
- `content` - 任务内容
- `status` - 状态（待下发/已下发）

### t_student_task (学生任务表)
- `id` - 学生任务ID
- `task_id` - 关联任务ID
- `student_id` - 学生ID
- `is_completed` - 是否完成

### t_user (用户表)
- `id` - 用户ID
- `username` - 用户名
- `role` - 角色（ROLE_STUDENT/ROLE_TEACHER）
- `class_id` - 班级ID（⚠️ 关键字段）

---

## 🎯 检查清单

在报告问题前，请确认：

- [ ] 学生账号有`class_id`
- [ ] 教师发布任务时选择了正确的班级
- [ ] 任务状态为"已下发"
- [ ] t_student_task表中有学生任务记录
- [ ] 后端服务正在运行
- [ ] 浏览器Console没有报错
- [ ] 已经强制刷新浏览器（Ctrl + Shift + R）

---

## 📞 故障排查

如果完成上述步骤后仍然无法显示任务，请提供：

1. **学生账号信息**：
```sql
SELECT id, username, real_name, class_id FROM t_user WHERE username = '你的学生用户名';
```

2. **任务信息**：
```sql
SELECT id, title, class_id, status FROM t_task WHERE title LIKE '%测试%';
```

3. **学生任务记录**：
```sql
SELECT * FROM t_student_task WHERE student_id = 你的学生ID;
```

4. **浏览器Console的完整输出**（截图）

5. **后端Console的日志**（如果有）

---

## 🎉 成功标志

当一切正常工作时，你应该看到：

✅ **教师端**：
- 可以创建任务
- 可以选择班级
- AI可以解析任务内容
- 发布成功后显示提示

✅ **学生端**：
- 进入"教师推送"页面
- 看到教师发布的任务
- 任务卡片显示完整信息
- 可以点击"开始任务"
- 可以标记任务完成

✅ **数据库**：
- t_task中有任务记录，status = "已下发"
- t_student_task中有学生任务记录
- student_id和task_id正确关联








